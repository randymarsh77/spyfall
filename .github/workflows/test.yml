name: Build and Test

on:
  push:
  pull_request:

jobs:
  test:
    name: Test Suite
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Install Nix
      uses: cachix/install-nix-action@v24
      with:
        github_access_token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Build and test
      run: |
        # Enter nix shell and run all checks
        nix develop --command bash -c "
          echo 'ğŸ” Checking code format...'
          format --check
          
          echo 'ğŸ” Running linter...'
          lint
          
          echo 'ğŸ”¨ Building project...'
          build
          
          echo 'ğŸ§ª Running tests...'
          test
          
          echo 'ğŸ“ Testing CLI...'
          spyfall --help
          spyfall locations
          
          echo 'âœ… All checks passed!'
        "
